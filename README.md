# README #

This idea was born because of the need for a simple tool in order to automate the execution of simple log analysis obtained from Nokia SROS routers. The tool reads the content of a log in `txt` or `json` format, parses only pre defined variables and does the comparison, thus verifying if there are changes in such variables . The logs are generated by the use of [taskAutom](https://github.com/laimaretto/taskAutom).

## Setup ##

#### System Libraries
These libraries have been tested under Ubuntu 20.04 and Python3.8.

```bash
sudo pip3 install -r requirements.txt
```

#### Compile
You can run `logAnalyzer` directly from the CLI using Python. However, compiling improves performance.

```bash
python3 -m nuitka logAnalizer.py
```
Compiling has been tested succesfully under Ubuntu. Don't know if this is directly supported under Windows. If it fails, let me know. Nevertheless, as mentioned, you can run `logAnalyzer_win` directly from the CLI using Python

## Usage

The program needs two mandatory inputs:
  - a folder which contains the parsing templates, either in `textFSM` or `ttp` format;
  - a folder, which contains the logs obtained a router, via [`taskAutom`](https://github.com/laimaretto/taskAutom). Though not mandatory, `taskAutom` is suggested as a way of obtaining the logs, because these can be stored in a json file.

### Templates

The templates are stored in the `Templates` folder. The script reads the CSV and uses the indicated templates to perform the function of parsing.

##### CSV

It is possible to use a CSV file, that includes the specific templates to be used in the analysys.

```csv
show_router_bgp_summary.template
show_router_interface.template
show_service_sdp.template
```
If omitted, all the templates insisde the templates folder, will be used.

##### Template Major Errors (V 0.3)

The file `majorFile.yml`, stores the name of a template and the key-words of Major errors after the task, if you don't specify the template in the file yml, the program searches the word 'down' automatically. The file must be present under the folder of the templates.

The format of file is:

```yml
show_router_ldp_session.template: ['down', 'Nonexistent', 'Initialized', 'OpenRecv', 'OpenSent']
show_router_bgp_summary.template: ['down', 'connect', 'active']
```

## Results

If `logAnalyzer` is invoked only with option `-pre`, reads the specific content in the log folder for a given command and then saves the results in an Excel report. We need to specify format of the logs, either `-json yes|no` and also the parsing engine, either `-te textFSM|ttp`. Also, the folder where the templates are located, with `-tf Folder`.

```bash
$ python3 logAnalyzer.py -csv templateExample.csv -pre folderLogs/ -json yes -te ttp -tf TemplatesTTP/

<_io.TextIOWrapper name='Templates/nokia_sros_show_service_sdp-using.template' mode='r' encoding='UTF-8'>
#####Plantillas Cargadas Exitosamente#####
#########Logs Cargados Exitosamente#########
ROUTER_EXAMPLE_rx.txt nokia_sros_show_service_sdp-using.template
#
#
Saving Excel
#
```
On the other hand, if `logAnalyzer` is invoked with folder `-pre` and `-post`, it compares the content of pre and post log folders, such as if we run checks to see the status of the routers before and after a task, and then saves the results in an Excel report.

```bash
$ python3 logAnalyzer.py -csv templateExample.csv -pre folderLogsBefore/ -post folderLogsAfter/ -json yes --te textFSM -tf TemplatesFSM/

<_io.TextIOWrapper name='Templates/nokia_sros_show_service_sdp-using.template' mode='r' encoding='UTF-8'>
#####Plantillas Cargadas Exitosamente#####
#########Logs Cargados Exitosamente#########
#########Logs Cargados Exitosamente#########
ROUTER_EXAMPLE_rx.txt nokia_sros_show_service_sdp-using.template
ROUTER_EXAMPLE_rx.txt nokia_sros_show_service_sdp-using.template
#
#
Saving Excel
#
```

## Configuration Options

`logAnalyzer` can be configured through CLI as shown below.

```bash
$ python3 logAnalyzer.py -h
usage: PROG [options]

Log Analysis

optional arguments:
  -h, --help            show this help message and exit
  -pre PREFOLDER, --preFolder PREFOLDER
                        Folder with PRE Logs. Must end in "/"
  -post POSTFOLDER, --postFolder POSTFOLDER
                        Folder with POST Logs. Must end in "/"
  -csv CSVTEMPLATE, --csvTemplate CSVTEMPLATE
                        CSV with list of templates names to be used in parsing. If the file is omitted, then all the templates inside --templateFolder, will be considered for parsing. Default=None.
  -json {yes,no}, --formatJson {yes,no}
                        logs in json format: yes or no.
  -tf TEMPLATEFOLDER, --templateFolder TEMPLATEFOLDER
                        Folder where templates reside. Default=TemplatesTextFSM/
  -te {ttp,textFSM}, --templateEngine {ttp,textFSM}
                        Engine for parsing.
  -v, --version         Version

```
